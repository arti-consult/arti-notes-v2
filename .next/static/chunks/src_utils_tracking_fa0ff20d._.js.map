{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file://D%3A/breyholtz%20holding/arti-notes/arti-notes-v2/src/utils/tracking/server.ts"],"sourcesContent":["\"use server\";\r\n\r\n// src/utils/tracking/server.ts\r\nimport { createClient } from \"@/utils/supabase/server\";\r\nimport { cookies } from \"next/headers\";\r\nimport { UTMParams } from \"./utm\";\r\nimport {\r\n  UTM_COOKIE_NAME,\r\n  VISIT_COOKIE_NAME,\r\n  ANONYMOUS_ID_COOKIE,\r\n  COOKIE_OPTIONS,\r\n} from \"./constants\";\r\n\r\n/**\r\n * Get cookie store, handling both Pages Router and App Router\r\n */\r\nasync function getCookieStore() {\r\n  const cookieStore = cookies();\r\n  return cookieStore instanceof Promise ? await cookieStore : cookieStore;\r\n}\r\n\r\n/**\r\n * Link anonymous tracking data to a user after they sign up or log in\r\n */\r\nexport async function linkTrackingDataToUser(userId: string): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n    const cookieStore = await getCookieStore();\r\n\r\n    // Get anonymous ID from cookies\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE)?.value;\r\n\r\n    if (!anonymousId) {\r\n      return;\r\n    }\r\n\r\n    // Update all tracking data records with this anonymous ID to link to the user\r\n    await supabase\r\n      .from(\"tracking_data\")\r\n      .update({ user_id: userId })\r\n      .eq(\"anonymous_id\", anonymousId)\r\n      .is(\"user_id\", null);\r\n  } catch (error) {\r\n    console.error(\"Error linking tracking data to user:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest tracking data for a user\r\n */\r\nexport async function getUserTrackingData(userId: string) {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"tracking_data\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Error getting user tracking data:\", error);\r\n      return null;\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Error getting user tracking data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Save UTM data during onboarding\r\n */\r\nexport async function saveUTMDataDuringOnboarding(\r\n  userId: string,\r\n  onboardingId: string\r\n): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Get latest tracking data for the user\r\n    const trackingData = await getUserTrackingData(userId);\r\n\r\n    if (!trackingData) return;\r\n\r\n    // Update onboarding record with UTM data\r\n    await supabase\r\n      .from(\"user_onboarding\")\r\n      .update({\r\n        tracking_data_id: trackingData.id,\r\n        utm_source: trackingData.utm_source,\r\n        utm_medium: trackingData.utm_medium,\r\n        utm_campaign: trackingData.utm_campaign,\r\n        referrer: trackingData.referrer,\r\n      })\r\n      .eq(\"id\", onboardingId);\r\n  } catch (error) {\r\n    console.error(\"Error saving UTM data during onboarding:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get UTM data from cookie on the server\r\n */\r\nexport async function getServerUTMData(): Promise<UTMParams | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const utmData = cookieStore.get(UTM_COOKIE_NAME);\r\n    return utmData ? JSON.parse(utmData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server UTM data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get visit data from cookie on the server\r\n */\r\nexport async function getServerVisitData(): Promise<{\r\n  first_visit?: string;\r\n  referrer?: string;\r\n  landing_page?: string;\r\n} | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const visitData = cookieStore.get(VISIT_COOKIE_NAME);\r\n    return visitData ? JSON.parse(visitData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server visit data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get anonymous ID from cookie on the server\r\n */\r\nexport async function getServerAnonymousId(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE);\r\n    return anonymousId ? anonymousId.value : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server anonymous ID:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all tracking data from cookies on the server\r\n */\r\nexport async function getServerTrackingData(): Promise<{\r\n  utmData: UTMParams | null;\r\n  visitData: {\r\n    first_visit?: string;\r\n    referrer?: string;\r\n    landing_page?: string;\r\n  } | null;\r\n  anonymousId: string | null;\r\n}> {\r\n  const [utmData, visitData, anonymousId] = await Promise.all([\r\n    getServerUTMData(),\r\n    getServerVisitData(),\r\n    getServerAnonymousId(),\r\n  ]);\r\n\r\n  return {\r\n    utmData,\r\n    visitData,\r\n    anonymousId,\r\n  };\r\n}\r\n\r\n/**\r\n * Set UTM data in cookie on the server\r\n */\r\nexport async function setServerUTMData(data: UTMParams): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(UTM_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server UTM data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set visit data in cookie on the server\r\n */\r\nexport async function setServerVisitData(data: {\r\n  first_visit: string;\r\n  referrer?: string;\r\n  landing_page: string;\r\n}): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(VISIT_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server visit data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set anonymous ID in cookie on the server\r\n */\r\nexport async function setServerAnonymousId(id: string): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(ANONYMOUS_ID_COOKIE, id, {\r\n      ...COOKIE_OPTIONS,\r\n      expires: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error setting server anonymous ID:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all tracking cookies on the server\r\n */\r\nexport async function clearServerTrackingCookies(): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.delete(UTM_COOKIE_NAME);\r\n    cookieStore.delete(VISIT_COOKIE_NAME);\r\n    cookieStore.delete(ANONYMOUS_ID_COOKIE);\r\n  } catch (error) {\r\n    console.error(\"Error clearing server tracking cookies:\", error);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;IAwBsB,yBAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 50, "column": 0}, "map": {"version":3,"sources":["file://D%3A/breyholtz%20holding/arti-notes/arti-notes-v2/src/utils/tracking/server.ts"],"sourcesContent":["\"use server\";\r\n\r\n// src/utils/tracking/server.ts\r\nimport { createClient } from \"@/utils/supabase/server\";\r\nimport { cookies } from \"next/headers\";\r\nimport { UTMParams } from \"./utm\";\r\nimport {\r\n  UTM_COOKIE_NAME,\r\n  VISIT_COOKIE_NAME,\r\n  ANONYMOUS_ID_COOKIE,\r\n  COOKIE_OPTIONS,\r\n} from \"./constants\";\r\n\r\n/**\r\n * Get cookie store, handling both Pages Router and App Router\r\n */\r\nasync function getCookieStore() {\r\n  const cookieStore = cookies();\r\n  return cookieStore instanceof Promise ? await cookieStore : cookieStore;\r\n}\r\n\r\n/**\r\n * Link anonymous tracking data to a user after they sign up or log in\r\n */\r\nexport async function linkTrackingDataToUser(userId: string): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n    const cookieStore = await getCookieStore();\r\n\r\n    // Get anonymous ID from cookies\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE)?.value;\r\n\r\n    if (!anonymousId) {\r\n      return;\r\n    }\r\n\r\n    // Update all tracking data records with this anonymous ID to link to the user\r\n    await supabase\r\n      .from(\"tracking_data\")\r\n      .update({ user_id: userId })\r\n      .eq(\"anonymous_id\", anonymousId)\r\n      .is(\"user_id\", null);\r\n  } catch (error) {\r\n    console.error(\"Error linking tracking data to user:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest tracking data for a user\r\n */\r\nexport async function getUserTrackingData(userId: string) {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"tracking_data\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Error getting user tracking data:\", error);\r\n      return null;\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Error getting user tracking data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Save UTM data during onboarding\r\n */\r\nexport async function saveUTMDataDuringOnboarding(\r\n  userId: string,\r\n  onboardingId: string\r\n): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Get latest tracking data for the user\r\n    const trackingData = await getUserTrackingData(userId);\r\n\r\n    if (!trackingData) return;\r\n\r\n    // Update onboarding record with UTM data\r\n    await supabase\r\n      .from(\"user_onboarding\")\r\n      .update({\r\n        tracking_data_id: trackingData.id,\r\n        utm_source: trackingData.utm_source,\r\n        utm_medium: trackingData.utm_medium,\r\n        utm_campaign: trackingData.utm_campaign,\r\n        referrer: trackingData.referrer,\r\n      })\r\n      .eq(\"id\", onboardingId);\r\n  } catch (error) {\r\n    console.error(\"Error saving UTM data during onboarding:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get UTM data from cookie on the server\r\n */\r\nexport async function getServerUTMData(): Promise<UTMParams | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const utmData = cookieStore.get(UTM_COOKIE_NAME);\r\n    return utmData ? JSON.parse(utmData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server UTM data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get visit data from cookie on the server\r\n */\r\nexport async function getServerVisitData(): Promise<{\r\n  first_visit?: string;\r\n  referrer?: string;\r\n  landing_page?: string;\r\n} | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const visitData = cookieStore.get(VISIT_COOKIE_NAME);\r\n    return visitData ? JSON.parse(visitData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server visit data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get anonymous ID from cookie on the server\r\n */\r\nexport async function getServerAnonymousId(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE);\r\n    return anonymousId ? anonymousId.value : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server anonymous ID:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all tracking data from cookies on the server\r\n */\r\nexport async function getServerTrackingData(): Promise<{\r\n  utmData: UTMParams | null;\r\n  visitData: {\r\n    first_visit?: string;\r\n    referrer?: string;\r\n    landing_page?: string;\r\n  } | null;\r\n  anonymousId: string | null;\r\n}> {\r\n  const [utmData, visitData, anonymousId] = await Promise.all([\r\n    getServerUTMData(),\r\n    getServerVisitData(),\r\n    getServerAnonymousId(),\r\n  ]);\r\n\r\n  return {\r\n    utmData,\r\n    visitData,\r\n    anonymousId,\r\n  };\r\n}\r\n\r\n/**\r\n * Set UTM data in cookie on the server\r\n */\r\nexport async function setServerUTMData(data: UTMParams): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(UTM_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server UTM data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set visit data in cookie on the server\r\n */\r\nexport async function setServerVisitData(data: {\r\n  first_visit: string;\r\n  referrer?: string;\r\n  landing_page: string;\r\n}): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(VISIT_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server visit data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set anonymous ID in cookie on the server\r\n */\r\nexport async function setServerAnonymousId(id: string): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(ANONYMOUS_ID_COOKIE, id, {\r\n      ...COOKIE_OPTIONS,\r\n      expires: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error setting server anonymous ID:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all tracking cookies on the server\r\n */\r\nexport async function clearServerTrackingCookies(): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.delete(UTM_COOKIE_NAME);\r\n    cookieStore.delete(VISIT_COOKIE_NAME);\r\n    cookieStore.delete(ANONYMOUS_ID_COOKIE);\r\n  } catch (error) {\r\n    console.error(\"Error clearing server tracking cookies:\", error);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;IAkDsB,sBAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file://D%3A/breyholtz%20holding/arti-notes/arti-notes-v2/src/utils/tracking/server.ts"],"sourcesContent":["\"use server\";\r\n\r\n// src/utils/tracking/server.ts\r\nimport { createClient } from \"@/utils/supabase/server\";\r\nimport { cookies } from \"next/headers\";\r\nimport { UTMParams } from \"./utm\";\r\nimport {\r\n  UTM_COOKIE_NAME,\r\n  VISIT_COOKIE_NAME,\r\n  ANONYMOUS_ID_COOKIE,\r\n  COOKIE_OPTIONS,\r\n} from \"./constants\";\r\n\r\n/**\r\n * Get cookie store, handling both Pages Router and App Router\r\n */\r\nasync function getCookieStore() {\r\n  const cookieStore = cookies();\r\n  return cookieStore instanceof Promise ? await cookieStore : cookieStore;\r\n}\r\n\r\n/**\r\n * Link anonymous tracking data to a user after they sign up or log in\r\n */\r\nexport async function linkTrackingDataToUser(userId: string): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n    const cookieStore = await getCookieStore();\r\n\r\n    // Get anonymous ID from cookies\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE)?.value;\r\n\r\n    if (!anonymousId) {\r\n      return;\r\n    }\r\n\r\n    // Update all tracking data records with this anonymous ID to link to the user\r\n    await supabase\r\n      .from(\"tracking_data\")\r\n      .update({ user_id: userId })\r\n      .eq(\"anonymous_id\", anonymousId)\r\n      .is(\"user_id\", null);\r\n  } catch (error) {\r\n    console.error(\"Error linking tracking data to user:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest tracking data for a user\r\n */\r\nexport async function getUserTrackingData(userId: string) {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"tracking_data\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Error getting user tracking data:\", error);\r\n      return null;\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Error getting user tracking data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Save UTM data during onboarding\r\n */\r\nexport async function saveUTMDataDuringOnboarding(\r\n  userId: string,\r\n  onboardingId: string\r\n): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Get latest tracking data for the user\r\n    const trackingData = await getUserTrackingData(userId);\r\n\r\n    if (!trackingData) return;\r\n\r\n    // Update onboarding record with UTM data\r\n    await supabase\r\n      .from(\"user_onboarding\")\r\n      .update({\r\n        tracking_data_id: trackingData.id,\r\n        utm_source: trackingData.utm_source,\r\n        utm_medium: trackingData.utm_medium,\r\n        utm_campaign: trackingData.utm_campaign,\r\n        referrer: trackingData.referrer,\r\n      })\r\n      .eq(\"id\", onboardingId);\r\n  } catch (error) {\r\n    console.error(\"Error saving UTM data during onboarding:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get UTM data from cookie on the server\r\n */\r\nexport async function getServerUTMData(): Promise<UTMParams | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const utmData = cookieStore.get(UTM_COOKIE_NAME);\r\n    return utmData ? JSON.parse(utmData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server UTM data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get visit data from cookie on the server\r\n */\r\nexport async function getServerVisitData(): Promise<{\r\n  first_visit?: string;\r\n  referrer?: string;\r\n  landing_page?: string;\r\n} | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const visitData = cookieStore.get(VISIT_COOKIE_NAME);\r\n    return visitData ? JSON.parse(visitData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server visit data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get anonymous ID from cookie on the server\r\n */\r\nexport async function getServerAnonymousId(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE);\r\n    return anonymousId ? anonymousId.value : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server anonymous ID:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all tracking data from cookies on the server\r\n */\r\nexport async function getServerTrackingData(): Promise<{\r\n  utmData: UTMParams | null;\r\n  visitData: {\r\n    first_visit?: string;\r\n    referrer?: string;\r\n    landing_page?: string;\r\n  } | null;\r\n  anonymousId: string | null;\r\n}> {\r\n  const [utmData, visitData, anonymousId] = await Promise.all([\r\n    getServerUTMData(),\r\n    getServerVisitData(),\r\n    getServerAnonymousId(),\r\n  ]);\r\n\r\n  return {\r\n    utmData,\r\n    visitData,\r\n    anonymousId,\r\n  };\r\n}\r\n\r\n/**\r\n * Set UTM data in cookie on the server\r\n */\r\nexport async function setServerUTMData(data: UTMParams): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(UTM_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server UTM data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set visit data in cookie on the server\r\n */\r\nexport async function setServerVisitData(data: {\r\n  first_visit: string;\r\n  referrer?: string;\r\n  landing_page: string;\r\n}): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(VISIT_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server visit data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set anonymous ID in cookie on the server\r\n */\r\nexport async function setServerAnonymousId(id: string): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(ANONYMOUS_ID_COOKIE, id, {\r\n      ...COOKIE_OPTIONS,\r\n      expires: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error setting server anonymous ID:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all tracking cookies on the server\r\n */\r\nexport async function clearServerTrackingCookies(): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.delete(UTM_COOKIE_NAME);\r\n    cookieStore.delete(VISIT_COOKIE_NAME);\r\n    cookieStore.delete(ANONYMOUS_ID_COOKIE);\r\n  } catch (error) {\r\n    console.error(\"Error clearing server tracking cookies:\", error);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;IA6EsB,8BAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file://D%3A/breyholtz%20holding/arti-notes/arti-notes-v2/src/utils/tracking/server.ts"],"sourcesContent":["\"use server\";\r\n\r\n// src/utils/tracking/server.ts\r\nimport { createClient } from \"@/utils/supabase/server\";\r\nimport { cookies } from \"next/headers\";\r\nimport { UTMParams } from \"./utm\";\r\nimport {\r\n  UTM_COOKIE_NAME,\r\n  VISIT_COOKIE_NAME,\r\n  ANONYMOUS_ID_COOKIE,\r\n  COOKIE_OPTIONS,\r\n} from \"./constants\";\r\n\r\n/**\r\n * Get cookie store, handling both Pages Router and App Router\r\n */\r\nasync function getCookieStore() {\r\n  const cookieStore = cookies();\r\n  return cookieStore instanceof Promise ? await cookieStore : cookieStore;\r\n}\r\n\r\n/**\r\n * Link anonymous tracking data to a user after they sign up or log in\r\n */\r\nexport async function linkTrackingDataToUser(userId: string): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n    const cookieStore = await getCookieStore();\r\n\r\n    // Get anonymous ID from cookies\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE)?.value;\r\n\r\n    if (!anonymousId) {\r\n      return;\r\n    }\r\n\r\n    // Update all tracking data records with this anonymous ID to link to the user\r\n    await supabase\r\n      .from(\"tracking_data\")\r\n      .update({ user_id: userId })\r\n      .eq(\"anonymous_id\", anonymousId)\r\n      .is(\"user_id\", null);\r\n  } catch (error) {\r\n    console.error(\"Error linking tracking data to user:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest tracking data for a user\r\n */\r\nexport async function getUserTrackingData(userId: string) {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"tracking_data\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Error getting user tracking data:\", error);\r\n      return null;\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Error getting user tracking data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Save UTM data during onboarding\r\n */\r\nexport async function saveUTMDataDuringOnboarding(\r\n  userId: string,\r\n  onboardingId: string\r\n): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Get latest tracking data for the user\r\n    const trackingData = await getUserTrackingData(userId);\r\n\r\n    if (!trackingData) return;\r\n\r\n    // Update onboarding record with UTM data\r\n    await supabase\r\n      .from(\"user_onboarding\")\r\n      .update({\r\n        tracking_data_id: trackingData.id,\r\n        utm_source: trackingData.utm_source,\r\n        utm_medium: trackingData.utm_medium,\r\n        utm_campaign: trackingData.utm_campaign,\r\n        referrer: trackingData.referrer,\r\n      })\r\n      .eq(\"id\", onboardingId);\r\n  } catch (error) {\r\n    console.error(\"Error saving UTM data during onboarding:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get UTM data from cookie on the server\r\n */\r\nexport async function getServerUTMData(): Promise<UTMParams | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const utmData = cookieStore.get(UTM_COOKIE_NAME);\r\n    return utmData ? JSON.parse(utmData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server UTM data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get visit data from cookie on the server\r\n */\r\nexport async function getServerVisitData(): Promise<{\r\n  first_visit?: string;\r\n  referrer?: string;\r\n  landing_page?: string;\r\n} | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const visitData = cookieStore.get(VISIT_COOKIE_NAME);\r\n    return visitData ? JSON.parse(visitData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server visit data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get anonymous ID from cookie on the server\r\n */\r\nexport async function getServerAnonymousId(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE);\r\n    return anonymousId ? anonymousId.value : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server anonymous ID:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all tracking data from cookies on the server\r\n */\r\nexport async function getServerTrackingData(): Promise<{\r\n  utmData: UTMParams | null;\r\n  visitData: {\r\n    first_visit?: string;\r\n    referrer?: string;\r\n    landing_page?: string;\r\n  } | null;\r\n  anonymousId: string | null;\r\n}> {\r\n  const [utmData, visitData, anonymousId] = await Promise.all([\r\n    getServerUTMData(),\r\n    getServerVisitData(),\r\n    getServerAnonymousId(),\r\n  ]);\r\n\r\n  return {\r\n    utmData,\r\n    visitData,\r\n    anonymousId,\r\n  };\r\n}\r\n\r\n/**\r\n * Set UTM data in cookie on the server\r\n */\r\nexport async function setServerUTMData(data: UTMParams): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(UTM_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server UTM data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set visit data in cookie on the server\r\n */\r\nexport async function setServerVisitData(data: {\r\n  first_visit: string;\r\n  referrer?: string;\r\n  landing_page: string;\r\n}): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(VISIT_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server visit data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set anonymous ID in cookie on the server\r\n */\r\nexport async function setServerAnonymousId(id: string): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(ANONYMOUS_ID_COOKIE, id, {\r\n      ...COOKIE_OPTIONS,\r\n      expires: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error setting server anonymous ID:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all tracking cookies on the server\r\n */\r\nexport async function clearServerTrackingCookies(): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.delete(UTM_COOKIE_NAME);\r\n    cookieStore.delete(VISIT_COOKIE_NAME);\r\n    cookieStore.delete(ANONYMOUS_ID_COOKIE);\r\n  } catch (error) {\r\n    console.error(\"Error clearing server tracking cookies:\", error);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;IA4GsB,mBAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file://D%3A/breyholtz%20holding/arti-notes/arti-notes-v2/src/utils/tracking/server.ts"],"sourcesContent":["\"use server\";\r\n\r\n// src/utils/tracking/server.ts\r\nimport { createClient } from \"@/utils/supabase/server\";\r\nimport { cookies } from \"next/headers\";\r\nimport { UTMParams } from \"./utm\";\r\nimport {\r\n  UTM_COOKIE_NAME,\r\n  VISIT_COOKIE_NAME,\r\n  ANONYMOUS_ID_COOKIE,\r\n  COOKIE_OPTIONS,\r\n} from \"./constants\";\r\n\r\n/**\r\n * Get cookie store, handling both Pages Router and App Router\r\n */\r\nasync function getCookieStore() {\r\n  const cookieStore = cookies();\r\n  return cookieStore instanceof Promise ? await cookieStore : cookieStore;\r\n}\r\n\r\n/**\r\n * Link anonymous tracking data to a user after they sign up or log in\r\n */\r\nexport async function linkTrackingDataToUser(userId: string): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n    const cookieStore = await getCookieStore();\r\n\r\n    // Get anonymous ID from cookies\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE)?.value;\r\n\r\n    if (!anonymousId) {\r\n      return;\r\n    }\r\n\r\n    // Update all tracking data records with this anonymous ID to link to the user\r\n    await supabase\r\n      .from(\"tracking_data\")\r\n      .update({ user_id: userId })\r\n      .eq(\"anonymous_id\", anonymousId)\r\n      .is(\"user_id\", null);\r\n  } catch (error) {\r\n    console.error(\"Error linking tracking data to user:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest tracking data for a user\r\n */\r\nexport async function getUserTrackingData(userId: string) {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"tracking_data\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Error getting user tracking data:\", error);\r\n      return null;\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Error getting user tracking data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Save UTM data during onboarding\r\n */\r\nexport async function saveUTMDataDuringOnboarding(\r\n  userId: string,\r\n  onboardingId: string\r\n): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Get latest tracking data for the user\r\n    const trackingData = await getUserTrackingData(userId);\r\n\r\n    if (!trackingData) return;\r\n\r\n    // Update onboarding record with UTM data\r\n    await supabase\r\n      .from(\"user_onboarding\")\r\n      .update({\r\n        tracking_data_id: trackingData.id,\r\n        utm_source: trackingData.utm_source,\r\n        utm_medium: trackingData.utm_medium,\r\n        utm_campaign: trackingData.utm_campaign,\r\n        referrer: trackingData.referrer,\r\n      })\r\n      .eq(\"id\", onboardingId);\r\n  } catch (error) {\r\n    console.error(\"Error saving UTM data during onboarding:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get UTM data from cookie on the server\r\n */\r\nexport async function getServerUTMData(): Promise<UTMParams | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const utmData = cookieStore.get(UTM_COOKIE_NAME);\r\n    return utmData ? JSON.parse(utmData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server UTM data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get visit data from cookie on the server\r\n */\r\nexport async function getServerVisitData(): Promise<{\r\n  first_visit?: string;\r\n  referrer?: string;\r\n  landing_page?: string;\r\n} | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const visitData = cookieStore.get(VISIT_COOKIE_NAME);\r\n    return visitData ? JSON.parse(visitData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server visit data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get anonymous ID from cookie on the server\r\n */\r\nexport async function getServerAnonymousId(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE);\r\n    return anonymousId ? anonymousId.value : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server anonymous ID:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all tracking data from cookies on the server\r\n */\r\nexport async function getServerTrackingData(): Promise<{\r\n  utmData: UTMParams | null;\r\n  visitData: {\r\n    first_visit?: string;\r\n    referrer?: string;\r\n    landing_page?: string;\r\n  } | null;\r\n  anonymousId: string | null;\r\n}> {\r\n  const [utmData, visitData, anonymousId] = await Promise.all([\r\n    getServerUTMData(),\r\n    getServerVisitData(),\r\n    getServerAnonymousId(),\r\n  ]);\r\n\r\n  return {\r\n    utmData,\r\n    visitData,\r\n    anonymousId,\r\n  };\r\n}\r\n\r\n/**\r\n * Set UTM data in cookie on the server\r\n */\r\nexport async function setServerUTMData(data: UTMParams): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(UTM_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server UTM data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set visit data in cookie on the server\r\n */\r\nexport async function setServerVisitData(data: {\r\n  first_visit: string;\r\n  referrer?: string;\r\n  landing_page: string;\r\n}): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(VISIT_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server visit data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set anonymous ID in cookie on the server\r\n */\r\nexport async function setServerAnonymousId(id: string): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(ANONYMOUS_ID_COOKIE, id, {\r\n      ...COOKIE_OPTIONS,\r\n      expires: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error setting server anonymous ID:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all tracking cookies on the server\r\n */\r\nexport async function clearServerTrackingCookies(): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.delete(UTM_COOKIE_NAME);\r\n    cookieStore.delete(VISIT_COOKIE_NAME);\r\n    cookieStore.delete(ANONYMOUS_ID_COOKIE);\r\n  } catch (error) {\r\n    console.error(\"Error clearing server tracking cookies:\", error);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;IA0HsB,qBAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file://D%3A/breyholtz%20holding/arti-notes/arti-notes-v2/src/utils/tracking/server.ts"],"sourcesContent":["\"use server\";\r\n\r\n// src/utils/tracking/server.ts\r\nimport { createClient } from \"@/utils/supabase/server\";\r\nimport { cookies } from \"next/headers\";\r\nimport { UTMParams } from \"./utm\";\r\nimport {\r\n  UTM_COOKIE_NAME,\r\n  VISIT_COOKIE_NAME,\r\n  ANONYMOUS_ID_COOKIE,\r\n  COOKIE_OPTIONS,\r\n} from \"./constants\";\r\n\r\n/**\r\n * Get cookie store, handling both Pages Router and App Router\r\n */\r\nasync function getCookieStore() {\r\n  const cookieStore = cookies();\r\n  return cookieStore instanceof Promise ? await cookieStore : cookieStore;\r\n}\r\n\r\n/**\r\n * Link anonymous tracking data to a user after they sign up or log in\r\n */\r\nexport async function linkTrackingDataToUser(userId: string): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n    const cookieStore = await getCookieStore();\r\n\r\n    // Get anonymous ID from cookies\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE)?.value;\r\n\r\n    if (!anonymousId) {\r\n      return;\r\n    }\r\n\r\n    // Update all tracking data records with this anonymous ID to link to the user\r\n    await supabase\r\n      .from(\"tracking_data\")\r\n      .update({ user_id: userId })\r\n      .eq(\"anonymous_id\", anonymousId)\r\n      .is(\"user_id\", null);\r\n  } catch (error) {\r\n    console.error(\"Error linking tracking data to user:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest tracking data for a user\r\n */\r\nexport async function getUserTrackingData(userId: string) {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"tracking_data\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Error getting user tracking data:\", error);\r\n      return null;\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Error getting user tracking data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Save UTM data during onboarding\r\n */\r\nexport async function saveUTMDataDuringOnboarding(\r\n  userId: string,\r\n  onboardingId: string\r\n): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Get latest tracking data for the user\r\n    const trackingData = await getUserTrackingData(userId);\r\n\r\n    if (!trackingData) return;\r\n\r\n    // Update onboarding record with UTM data\r\n    await supabase\r\n      .from(\"user_onboarding\")\r\n      .update({\r\n        tracking_data_id: trackingData.id,\r\n        utm_source: trackingData.utm_source,\r\n        utm_medium: trackingData.utm_medium,\r\n        utm_campaign: trackingData.utm_campaign,\r\n        referrer: trackingData.referrer,\r\n      })\r\n      .eq(\"id\", onboardingId);\r\n  } catch (error) {\r\n    console.error(\"Error saving UTM data during onboarding:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get UTM data from cookie on the server\r\n */\r\nexport async function getServerUTMData(): Promise<UTMParams | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const utmData = cookieStore.get(UTM_COOKIE_NAME);\r\n    return utmData ? JSON.parse(utmData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server UTM data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get visit data from cookie on the server\r\n */\r\nexport async function getServerVisitData(): Promise<{\r\n  first_visit?: string;\r\n  referrer?: string;\r\n  landing_page?: string;\r\n} | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const visitData = cookieStore.get(VISIT_COOKIE_NAME);\r\n    return visitData ? JSON.parse(visitData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server visit data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get anonymous ID from cookie on the server\r\n */\r\nexport async function getServerAnonymousId(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE);\r\n    return anonymousId ? anonymousId.value : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server anonymous ID:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all tracking data from cookies on the server\r\n */\r\nexport async function getServerTrackingData(): Promise<{\r\n  utmData: UTMParams | null;\r\n  visitData: {\r\n    first_visit?: string;\r\n    referrer?: string;\r\n    landing_page?: string;\r\n  } | null;\r\n  anonymousId: string | null;\r\n}> {\r\n  const [utmData, visitData, anonymousId] = await Promise.all([\r\n    getServerUTMData(),\r\n    getServerVisitData(),\r\n    getServerAnonymousId(),\r\n  ]);\r\n\r\n  return {\r\n    utmData,\r\n    visitData,\r\n    anonymousId,\r\n  };\r\n}\r\n\r\n/**\r\n * Set UTM data in cookie on the server\r\n */\r\nexport async function setServerUTMData(data: UTMParams): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(UTM_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server UTM data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set visit data in cookie on the server\r\n */\r\nexport async function setServerVisitData(data: {\r\n  first_visit: string;\r\n  referrer?: string;\r\n  landing_page: string;\r\n}): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(VISIT_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server visit data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set anonymous ID in cookie on the server\r\n */\r\nexport async function setServerAnonymousId(id: string): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(ANONYMOUS_ID_COOKIE, id, {\r\n      ...COOKIE_OPTIONS,\r\n      expires: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error setting server anonymous ID:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all tracking cookies on the server\r\n */\r\nexport async function clearServerTrackingCookies(): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.delete(UTM_COOKIE_NAME);\r\n    cookieStore.delete(VISIT_COOKIE_NAME);\r\n    cookieStore.delete(ANONYMOUS_ID_COOKIE);\r\n  } catch (error) {\r\n    console.error(\"Error clearing server tracking cookies:\", error);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;IA4IsB,uBAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file://D%3A/breyholtz%20holding/arti-notes/arti-notes-v2/src/utils/tracking/server.ts"],"sourcesContent":["\"use server\";\r\n\r\n// src/utils/tracking/server.ts\r\nimport { createClient } from \"@/utils/supabase/server\";\r\nimport { cookies } from \"next/headers\";\r\nimport { UTMParams } from \"./utm\";\r\nimport {\r\n  UTM_COOKIE_NAME,\r\n  VISIT_COOKIE_NAME,\r\n  ANONYMOUS_ID_COOKIE,\r\n  COOKIE_OPTIONS,\r\n} from \"./constants\";\r\n\r\n/**\r\n * Get cookie store, handling both Pages Router and App Router\r\n */\r\nasync function getCookieStore() {\r\n  const cookieStore = cookies();\r\n  return cookieStore instanceof Promise ? await cookieStore : cookieStore;\r\n}\r\n\r\n/**\r\n * Link anonymous tracking data to a user after they sign up or log in\r\n */\r\nexport async function linkTrackingDataToUser(userId: string): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n    const cookieStore = await getCookieStore();\r\n\r\n    // Get anonymous ID from cookies\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE)?.value;\r\n\r\n    if (!anonymousId) {\r\n      return;\r\n    }\r\n\r\n    // Update all tracking data records with this anonymous ID to link to the user\r\n    await supabase\r\n      .from(\"tracking_data\")\r\n      .update({ user_id: userId })\r\n      .eq(\"anonymous_id\", anonymousId)\r\n      .is(\"user_id\", null);\r\n  } catch (error) {\r\n    console.error(\"Error linking tracking data to user:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest tracking data for a user\r\n */\r\nexport async function getUserTrackingData(userId: string) {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"tracking_data\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Error getting user tracking data:\", error);\r\n      return null;\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Error getting user tracking data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Save UTM data during onboarding\r\n */\r\nexport async function saveUTMDataDuringOnboarding(\r\n  userId: string,\r\n  onboardingId: string\r\n): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Get latest tracking data for the user\r\n    const trackingData = await getUserTrackingData(userId);\r\n\r\n    if (!trackingData) return;\r\n\r\n    // Update onboarding record with UTM data\r\n    await supabase\r\n      .from(\"user_onboarding\")\r\n      .update({\r\n        tracking_data_id: trackingData.id,\r\n        utm_source: trackingData.utm_source,\r\n        utm_medium: trackingData.utm_medium,\r\n        utm_campaign: trackingData.utm_campaign,\r\n        referrer: trackingData.referrer,\r\n      })\r\n      .eq(\"id\", onboardingId);\r\n  } catch (error) {\r\n    console.error(\"Error saving UTM data during onboarding:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get UTM data from cookie on the server\r\n */\r\nexport async function getServerUTMData(): Promise<UTMParams | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const utmData = cookieStore.get(UTM_COOKIE_NAME);\r\n    return utmData ? JSON.parse(utmData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server UTM data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get visit data from cookie on the server\r\n */\r\nexport async function getServerVisitData(): Promise<{\r\n  first_visit?: string;\r\n  referrer?: string;\r\n  landing_page?: string;\r\n} | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const visitData = cookieStore.get(VISIT_COOKIE_NAME);\r\n    return visitData ? JSON.parse(visitData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server visit data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get anonymous ID from cookie on the server\r\n */\r\nexport async function getServerAnonymousId(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE);\r\n    return anonymousId ? anonymousId.value : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server anonymous ID:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all tracking data from cookies on the server\r\n */\r\nexport async function getServerTrackingData(): Promise<{\r\n  utmData: UTMParams | null;\r\n  visitData: {\r\n    first_visit?: string;\r\n    referrer?: string;\r\n    landing_page?: string;\r\n  } | null;\r\n  anonymousId: string | null;\r\n}> {\r\n  const [utmData, visitData, anonymousId] = await Promise.all([\r\n    getServerUTMData(),\r\n    getServerVisitData(),\r\n    getServerAnonymousId(),\r\n  ]);\r\n\r\n  return {\r\n    utmData,\r\n    visitData,\r\n    anonymousId,\r\n  };\r\n}\r\n\r\n/**\r\n * Set UTM data in cookie on the server\r\n */\r\nexport async function setServerUTMData(data: UTMParams): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(UTM_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server UTM data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set visit data in cookie on the server\r\n */\r\nexport async function setServerVisitData(data: {\r\n  first_visit: string;\r\n  referrer?: string;\r\n  landing_page: string;\r\n}): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(VISIT_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server visit data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set anonymous ID in cookie on the server\r\n */\r\nexport async function setServerAnonymousId(id: string): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(ANONYMOUS_ID_COOKIE, id, {\r\n      ...COOKIE_OPTIONS,\r\n      expires: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error setting server anonymous ID:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all tracking cookies on the server\r\n */\r\nexport async function clearServerTrackingCookies(): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.delete(UTM_COOKIE_NAME);\r\n    cookieStore.delete(VISIT_COOKIE_NAME);\r\n    cookieStore.delete(ANONYMOUS_ID_COOKIE);\r\n  } catch (error) {\r\n    console.error(\"Error clearing server tracking cookies:\", error);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;IA0JsB,wBAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 146, "column": 0}, "map": {"version":3,"sources":["file://D%3A/breyholtz%20holding/arti-notes/arti-notes-v2/src/utils/tracking/server.ts"],"sourcesContent":["\"use server\";\r\n\r\n// src/utils/tracking/server.ts\r\nimport { createClient } from \"@/utils/supabase/server\";\r\nimport { cookies } from \"next/headers\";\r\nimport { UTMParams } from \"./utm\";\r\nimport {\r\n  UTM_COOKIE_NAME,\r\n  VISIT_COOKIE_NAME,\r\n  ANONYMOUS_ID_COOKIE,\r\n  COOKIE_OPTIONS,\r\n} from \"./constants\";\r\n\r\n/**\r\n * Get cookie store, handling both Pages Router and App Router\r\n */\r\nasync function getCookieStore() {\r\n  const cookieStore = cookies();\r\n  return cookieStore instanceof Promise ? await cookieStore : cookieStore;\r\n}\r\n\r\n/**\r\n * Link anonymous tracking data to a user after they sign up or log in\r\n */\r\nexport async function linkTrackingDataToUser(userId: string): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n    const cookieStore = await getCookieStore();\r\n\r\n    // Get anonymous ID from cookies\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE)?.value;\r\n\r\n    if (!anonymousId) {\r\n      return;\r\n    }\r\n\r\n    // Update all tracking data records with this anonymous ID to link to the user\r\n    await supabase\r\n      .from(\"tracking_data\")\r\n      .update({ user_id: userId })\r\n      .eq(\"anonymous_id\", anonymousId)\r\n      .is(\"user_id\", null);\r\n  } catch (error) {\r\n    console.error(\"Error linking tracking data to user:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest tracking data for a user\r\n */\r\nexport async function getUserTrackingData(userId: string) {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"tracking_data\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Error getting user tracking data:\", error);\r\n      return null;\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Error getting user tracking data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Save UTM data during onboarding\r\n */\r\nexport async function saveUTMDataDuringOnboarding(\r\n  userId: string,\r\n  onboardingId: string\r\n): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Get latest tracking data for the user\r\n    const trackingData = await getUserTrackingData(userId);\r\n\r\n    if (!trackingData) return;\r\n\r\n    // Update onboarding record with UTM data\r\n    await supabase\r\n      .from(\"user_onboarding\")\r\n      .update({\r\n        tracking_data_id: trackingData.id,\r\n        utm_source: trackingData.utm_source,\r\n        utm_medium: trackingData.utm_medium,\r\n        utm_campaign: trackingData.utm_campaign,\r\n        referrer: trackingData.referrer,\r\n      })\r\n      .eq(\"id\", onboardingId);\r\n  } catch (error) {\r\n    console.error(\"Error saving UTM data during onboarding:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get UTM data from cookie on the server\r\n */\r\nexport async function getServerUTMData(): Promise<UTMParams | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const utmData = cookieStore.get(UTM_COOKIE_NAME);\r\n    return utmData ? JSON.parse(utmData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server UTM data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get visit data from cookie on the server\r\n */\r\nexport async function getServerVisitData(): Promise<{\r\n  first_visit?: string;\r\n  referrer?: string;\r\n  landing_page?: string;\r\n} | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const visitData = cookieStore.get(VISIT_COOKIE_NAME);\r\n    return visitData ? JSON.parse(visitData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server visit data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get anonymous ID from cookie on the server\r\n */\r\nexport async function getServerAnonymousId(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE);\r\n    return anonymousId ? anonymousId.value : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server anonymous ID:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all tracking data from cookies on the server\r\n */\r\nexport async function getServerTrackingData(): Promise<{\r\n  utmData: UTMParams | null;\r\n  visitData: {\r\n    first_visit?: string;\r\n    referrer?: string;\r\n    landing_page?: string;\r\n  } | null;\r\n  anonymousId: string | null;\r\n}> {\r\n  const [utmData, visitData, anonymousId] = await Promise.all([\r\n    getServerUTMData(),\r\n    getServerVisitData(),\r\n    getServerAnonymousId(),\r\n  ]);\r\n\r\n  return {\r\n    utmData,\r\n    visitData,\r\n    anonymousId,\r\n  };\r\n}\r\n\r\n/**\r\n * Set UTM data in cookie on the server\r\n */\r\nexport async function setServerUTMData(data: UTMParams): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(UTM_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server UTM data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set visit data in cookie on the server\r\n */\r\nexport async function setServerVisitData(data: {\r\n  first_visit: string;\r\n  referrer?: string;\r\n  landing_page: string;\r\n}): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(VISIT_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server visit data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set anonymous ID in cookie on the server\r\n */\r\nexport async function setServerAnonymousId(id: string): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(ANONYMOUS_ID_COOKIE, id, {\r\n      ...COOKIE_OPTIONS,\r\n      expires: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error setting server anonymous ID:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all tracking cookies on the server\r\n */\r\nexport async function clearServerTrackingCookies(): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.delete(UTM_COOKIE_NAME);\r\n    cookieStore.delete(VISIT_COOKIE_NAME);\r\n    cookieStore.delete(ANONYMOUS_ID_COOKIE);\r\n  } catch (error) {\r\n    console.error(\"Error clearing server tracking cookies:\", error);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;IAmLsB,mBAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file://D%3A/breyholtz%20holding/arti-notes/arti-notes-v2/src/utils/tracking/server.ts"],"sourcesContent":["\"use server\";\r\n\r\n// src/utils/tracking/server.ts\r\nimport { createClient } from \"@/utils/supabase/server\";\r\nimport { cookies } from \"next/headers\";\r\nimport { UTMParams } from \"./utm\";\r\nimport {\r\n  UTM_COOKIE_NAME,\r\n  VISIT_COOKIE_NAME,\r\n  ANONYMOUS_ID_COOKIE,\r\n  COOKIE_OPTIONS,\r\n} from \"./constants\";\r\n\r\n/**\r\n * Get cookie store, handling both Pages Router and App Router\r\n */\r\nasync function getCookieStore() {\r\n  const cookieStore = cookies();\r\n  return cookieStore instanceof Promise ? await cookieStore : cookieStore;\r\n}\r\n\r\n/**\r\n * Link anonymous tracking data to a user after they sign up or log in\r\n */\r\nexport async function linkTrackingDataToUser(userId: string): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n    const cookieStore = await getCookieStore();\r\n\r\n    // Get anonymous ID from cookies\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE)?.value;\r\n\r\n    if (!anonymousId) {\r\n      return;\r\n    }\r\n\r\n    // Update all tracking data records with this anonymous ID to link to the user\r\n    await supabase\r\n      .from(\"tracking_data\")\r\n      .update({ user_id: userId })\r\n      .eq(\"anonymous_id\", anonymousId)\r\n      .is(\"user_id\", null);\r\n  } catch (error) {\r\n    console.error(\"Error linking tracking data to user:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest tracking data for a user\r\n */\r\nexport async function getUserTrackingData(userId: string) {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"tracking_data\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Error getting user tracking data:\", error);\r\n      return null;\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Error getting user tracking data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Save UTM data during onboarding\r\n */\r\nexport async function saveUTMDataDuringOnboarding(\r\n  userId: string,\r\n  onboardingId: string\r\n): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Get latest tracking data for the user\r\n    const trackingData = await getUserTrackingData(userId);\r\n\r\n    if (!trackingData) return;\r\n\r\n    // Update onboarding record with UTM data\r\n    await supabase\r\n      .from(\"user_onboarding\")\r\n      .update({\r\n        tracking_data_id: trackingData.id,\r\n        utm_source: trackingData.utm_source,\r\n        utm_medium: trackingData.utm_medium,\r\n        utm_campaign: trackingData.utm_campaign,\r\n        referrer: trackingData.referrer,\r\n      })\r\n      .eq(\"id\", onboardingId);\r\n  } catch (error) {\r\n    console.error(\"Error saving UTM data during onboarding:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get UTM data from cookie on the server\r\n */\r\nexport async function getServerUTMData(): Promise<UTMParams | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const utmData = cookieStore.get(UTM_COOKIE_NAME);\r\n    return utmData ? JSON.parse(utmData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server UTM data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get visit data from cookie on the server\r\n */\r\nexport async function getServerVisitData(): Promise<{\r\n  first_visit?: string;\r\n  referrer?: string;\r\n  landing_page?: string;\r\n} | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const visitData = cookieStore.get(VISIT_COOKIE_NAME);\r\n    return visitData ? JSON.parse(visitData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server visit data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get anonymous ID from cookie on the server\r\n */\r\nexport async function getServerAnonymousId(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE);\r\n    return anonymousId ? anonymousId.value : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server anonymous ID:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all tracking data from cookies on the server\r\n */\r\nexport async function getServerTrackingData(): Promise<{\r\n  utmData: UTMParams | null;\r\n  visitData: {\r\n    first_visit?: string;\r\n    referrer?: string;\r\n    landing_page?: string;\r\n  } | null;\r\n  anonymousId: string | null;\r\n}> {\r\n  const [utmData, visitData, anonymousId] = await Promise.all([\r\n    getServerUTMData(),\r\n    getServerVisitData(),\r\n    getServerAnonymousId(),\r\n  ]);\r\n\r\n  return {\r\n    utmData,\r\n    visitData,\r\n    anonymousId,\r\n  };\r\n}\r\n\r\n/**\r\n * Set UTM data in cookie on the server\r\n */\r\nexport async function setServerUTMData(data: UTMParams): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(UTM_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server UTM data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set visit data in cookie on the server\r\n */\r\nexport async function setServerVisitData(data: {\r\n  first_visit: string;\r\n  referrer?: string;\r\n  landing_page: string;\r\n}): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(VISIT_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server visit data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set anonymous ID in cookie on the server\r\n */\r\nexport async function setServerAnonymousId(id: string): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(ANONYMOUS_ID_COOKIE, id, {\r\n      ...COOKIE_OPTIONS,\r\n      expires: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error setting server anonymous ID:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all tracking cookies on the server\r\n */\r\nexport async function clearServerTrackingCookies(): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.delete(UTM_COOKIE_NAME);\r\n    cookieStore.delete(VISIT_COOKIE_NAME);\r\n    cookieStore.delete(ANONYMOUS_ID_COOKIE);\r\n  } catch (error) {\r\n    console.error(\"Error clearing server tracking cookies:\", error);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;IA+LsB,qBAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 178, "column": 0}, "map": {"version":3,"sources":["file://D%3A/breyholtz%20holding/arti-notes/arti-notes-v2/src/utils/tracking/server.ts"],"sourcesContent":["\"use server\";\r\n\r\n// src/utils/tracking/server.ts\r\nimport { createClient } from \"@/utils/supabase/server\";\r\nimport { cookies } from \"next/headers\";\r\nimport { UTMParams } from \"./utm\";\r\nimport {\r\n  UTM_COOKIE_NAME,\r\n  VISIT_COOKIE_NAME,\r\n  ANONYMOUS_ID_COOKIE,\r\n  COOKIE_OPTIONS,\r\n} from \"./constants\";\r\n\r\n/**\r\n * Get cookie store, handling both Pages Router and App Router\r\n */\r\nasync function getCookieStore() {\r\n  const cookieStore = cookies();\r\n  return cookieStore instanceof Promise ? await cookieStore : cookieStore;\r\n}\r\n\r\n/**\r\n * Link anonymous tracking data to a user after they sign up or log in\r\n */\r\nexport async function linkTrackingDataToUser(userId: string): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n    const cookieStore = await getCookieStore();\r\n\r\n    // Get anonymous ID from cookies\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE)?.value;\r\n\r\n    if (!anonymousId) {\r\n      return;\r\n    }\r\n\r\n    // Update all tracking data records with this anonymous ID to link to the user\r\n    await supabase\r\n      .from(\"tracking_data\")\r\n      .update({ user_id: userId })\r\n      .eq(\"anonymous_id\", anonymousId)\r\n      .is(\"user_id\", null);\r\n  } catch (error) {\r\n    console.error(\"Error linking tracking data to user:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest tracking data for a user\r\n */\r\nexport async function getUserTrackingData(userId: string) {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"tracking_data\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Error getting user tracking data:\", error);\r\n      return null;\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Error getting user tracking data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Save UTM data during onboarding\r\n */\r\nexport async function saveUTMDataDuringOnboarding(\r\n  userId: string,\r\n  onboardingId: string\r\n): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Get latest tracking data for the user\r\n    const trackingData = await getUserTrackingData(userId);\r\n\r\n    if (!trackingData) return;\r\n\r\n    // Update onboarding record with UTM data\r\n    await supabase\r\n      .from(\"user_onboarding\")\r\n      .update({\r\n        tracking_data_id: trackingData.id,\r\n        utm_source: trackingData.utm_source,\r\n        utm_medium: trackingData.utm_medium,\r\n        utm_campaign: trackingData.utm_campaign,\r\n        referrer: trackingData.referrer,\r\n      })\r\n      .eq(\"id\", onboardingId);\r\n  } catch (error) {\r\n    console.error(\"Error saving UTM data during onboarding:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get UTM data from cookie on the server\r\n */\r\nexport async function getServerUTMData(): Promise<UTMParams | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const utmData = cookieStore.get(UTM_COOKIE_NAME);\r\n    return utmData ? JSON.parse(utmData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server UTM data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get visit data from cookie on the server\r\n */\r\nexport async function getServerVisitData(): Promise<{\r\n  first_visit?: string;\r\n  referrer?: string;\r\n  landing_page?: string;\r\n} | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const visitData = cookieStore.get(VISIT_COOKIE_NAME);\r\n    return visitData ? JSON.parse(visitData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server visit data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get anonymous ID from cookie on the server\r\n */\r\nexport async function getServerAnonymousId(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE);\r\n    return anonymousId ? anonymousId.value : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server anonymous ID:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all tracking data from cookies on the server\r\n */\r\nexport async function getServerTrackingData(): Promise<{\r\n  utmData: UTMParams | null;\r\n  visitData: {\r\n    first_visit?: string;\r\n    referrer?: string;\r\n    landing_page?: string;\r\n  } | null;\r\n  anonymousId: string | null;\r\n}> {\r\n  const [utmData, visitData, anonymousId] = await Promise.all([\r\n    getServerUTMData(),\r\n    getServerVisitData(),\r\n    getServerAnonymousId(),\r\n  ]);\r\n\r\n  return {\r\n    utmData,\r\n    visitData,\r\n    anonymousId,\r\n  };\r\n}\r\n\r\n/**\r\n * Set UTM data in cookie on the server\r\n */\r\nexport async function setServerUTMData(data: UTMParams): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(UTM_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server UTM data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set visit data in cookie on the server\r\n */\r\nexport async function setServerVisitData(data: {\r\n  first_visit: string;\r\n  referrer?: string;\r\n  landing_page: string;\r\n}): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(VISIT_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server visit data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set anonymous ID in cookie on the server\r\n */\r\nexport async function setServerAnonymousId(id: string): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(ANONYMOUS_ID_COOKIE, id, {\r\n      ...COOKIE_OPTIONS,\r\n      expires: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error setting server anonymous ID:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all tracking cookies on the server\r\n */\r\nexport async function clearServerTrackingCookies(): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.delete(UTM_COOKIE_NAME);\r\n    cookieStore.delete(VISIT_COOKIE_NAME);\r\n    cookieStore.delete(ANONYMOUS_ID_COOKIE);\r\n  } catch (error) {\r\n    console.error(\"Error clearing server tracking cookies:\", error);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;IA+MsB,uBAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file://D%3A/breyholtz%20holding/arti-notes/arti-notes-v2/src/utils/tracking/server.ts"],"sourcesContent":["\"use server\";\r\n\r\n// src/utils/tracking/server.ts\r\nimport { createClient } from \"@/utils/supabase/server\";\r\nimport { cookies } from \"next/headers\";\r\nimport { UTMParams } from \"./utm\";\r\nimport {\r\n  UTM_COOKIE_NAME,\r\n  VISIT_COOKIE_NAME,\r\n  ANONYMOUS_ID_COOKIE,\r\n  COOKIE_OPTIONS,\r\n} from \"./constants\";\r\n\r\n/**\r\n * Get cookie store, handling both Pages Router and App Router\r\n */\r\nasync function getCookieStore() {\r\n  const cookieStore = cookies();\r\n  return cookieStore instanceof Promise ? await cookieStore : cookieStore;\r\n}\r\n\r\n/**\r\n * Link anonymous tracking data to a user after they sign up or log in\r\n */\r\nexport async function linkTrackingDataToUser(userId: string): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n    const cookieStore = await getCookieStore();\r\n\r\n    // Get anonymous ID from cookies\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE)?.value;\r\n\r\n    if (!anonymousId) {\r\n      return;\r\n    }\r\n\r\n    // Update all tracking data records with this anonymous ID to link to the user\r\n    await supabase\r\n      .from(\"tracking_data\")\r\n      .update({ user_id: userId })\r\n      .eq(\"anonymous_id\", anonymousId)\r\n      .is(\"user_id\", null);\r\n  } catch (error) {\r\n    console.error(\"Error linking tracking data to user:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest tracking data for a user\r\n */\r\nexport async function getUserTrackingData(userId: string) {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"tracking_data\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Error getting user tracking data:\", error);\r\n      return null;\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Error getting user tracking data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Save UTM data during onboarding\r\n */\r\nexport async function saveUTMDataDuringOnboarding(\r\n  userId: string,\r\n  onboardingId: string\r\n): Promise<void> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Get latest tracking data for the user\r\n    const trackingData = await getUserTrackingData(userId);\r\n\r\n    if (!trackingData) return;\r\n\r\n    // Update onboarding record with UTM data\r\n    await supabase\r\n      .from(\"user_onboarding\")\r\n      .update({\r\n        tracking_data_id: trackingData.id,\r\n        utm_source: trackingData.utm_source,\r\n        utm_medium: trackingData.utm_medium,\r\n        utm_campaign: trackingData.utm_campaign,\r\n        referrer: trackingData.referrer,\r\n      })\r\n      .eq(\"id\", onboardingId);\r\n  } catch (error) {\r\n    console.error(\"Error saving UTM data during onboarding:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get UTM data from cookie on the server\r\n */\r\nexport async function getServerUTMData(): Promise<UTMParams | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const utmData = cookieStore.get(UTM_COOKIE_NAME);\r\n    return utmData ? JSON.parse(utmData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server UTM data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get visit data from cookie on the server\r\n */\r\nexport async function getServerVisitData(): Promise<{\r\n  first_visit?: string;\r\n  referrer?: string;\r\n  landing_page?: string;\r\n} | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const visitData = cookieStore.get(VISIT_COOKIE_NAME);\r\n    return visitData ? JSON.parse(visitData.value) : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server visit data:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get anonymous ID from cookie on the server\r\n */\r\nexport async function getServerAnonymousId(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    const anonymousId = cookieStore.get(ANONYMOUS_ID_COOKIE);\r\n    return anonymousId ? anonymousId.value : null;\r\n  } catch (error) {\r\n    console.error(\"Error getting server anonymous ID:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all tracking data from cookies on the server\r\n */\r\nexport async function getServerTrackingData(): Promise<{\r\n  utmData: UTMParams | null;\r\n  visitData: {\r\n    first_visit?: string;\r\n    referrer?: string;\r\n    landing_page?: string;\r\n  } | null;\r\n  anonymousId: string | null;\r\n}> {\r\n  const [utmData, visitData, anonymousId] = await Promise.all([\r\n    getServerUTMData(),\r\n    getServerVisitData(),\r\n    getServerAnonymousId(),\r\n  ]);\r\n\r\n  return {\r\n    utmData,\r\n    visitData,\r\n    anonymousId,\r\n  };\r\n}\r\n\r\n/**\r\n * Set UTM data in cookie on the server\r\n */\r\nexport async function setServerUTMData(data: UTMParams): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(UTM_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server UTM data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set visit data in cookie on the server\r\n */\r\nexport async function setServerVisitData(data: {\r\n  first_visit: string;\r\n  referrer?: string;\r\n  landing_page: string;\r\n}): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(VISIT_COOKIE_NAME, JSON.stringify(data), COOKIE_OPTIONS);\r\n  } catch (error) {\r\n    console.error(\"Error setting server visit data:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set anonymous ID in cookie on the server\r\n */\r\nexport async function setServerAnonymousId(id: string): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.set(ANONYMOUS_ID_COOKIE, id, {\r\n      ...COOKIE_OPTIONS,\r\n      expires: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error setting server anonymous ID:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all tracking cookies on the server\r\n */\r\nexport async function clearServerTrackingCookies(): Promise<void> {\r\n  try {\r\n    const cookieStore = await getCookieStore();\r\n    cookieStore.delete(UTM_COOKIE_NAME);\r\n    cookieStore.delete(VISIT_COOKIE_NAME);\r\n    cookieStore.delete(ANONYMOUS_ID_COOKIE);\r\n  } catch (error) {\r\n    console.error(\"Error clearing server tracking cookies:\", error);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;IA8NsB,6BAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}}]
}