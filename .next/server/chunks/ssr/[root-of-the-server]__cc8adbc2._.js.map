{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 47, "column": 0}, "map": {"version":3,"sources":["file:///D:/breyholtz%20holding/arti-notes/arti-notes-v3/src/utils/supabase/server.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { createServerClient } from \"@supabase/ssr\";\r\nimport { cookies } from \"next/headers\";\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies();\r\n\r\n  return createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        get(name: string) {\r\n          return cookieStore.get(name)?.value;\r\n        },\r\n        set(name: string, value: string, options: any) {\r\n          try {\r\n            cookieStore.set({ name, value, ...options });\r\n          } catch (error) {\r\n            // Handle cookie setting error\r\n            console.error(\"Error setting cookie:\", error);\r\n          }\r\n        },\r\n        remove(name: string, options: any) {\r\n          try {\r\n            cookieStore.set({ name, value: \"\", ...options });\r\n          } catch (error) {\r\n            // Handle cookie removal error\r\n            console.error(\"Error removing cookie:\", error);\r\n          }\r\n        },\r\n      },\r\n    }\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;;;;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD;IAEhC,OAAO,CAAA,GAAA,yKAAA,CAAA,qBAAkB,AAAD,sUAGtB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,OAAO,YAAY,GAAG,CAAC,OAAO;YAChC;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAY;gBAC3C,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM;wBAAO,GAAG,OAAO;oBAAC;gBAC5C,EAAE,OAAO,OAAO;oBACd,8BAA8B;oBAC9B,QAAQ,KAAK,CAAC,yBAAyB;gBACzC;YACF;YACA,QAAO,IAAY,EAAE,OAAY;gBAC/B,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM,OAAO;wBAAI,GAAG,OAAO;oBAAC;gBAChD,EAAE,OAAO,OAAO;oBACd,8BAA8B;oBAC9B,QAAQ,KAAK,CAAC,0BAA0B;gBAC1C;YACF;QACF;IACF;AAEJ;;;IA9BsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 105, "column": 0}, "map": {"version":3,"sources":["file:///D:/breyholtz%20holding/arti-notes/arti-notes-v3/src/app/%28auth%29/onboarding/actions.ts"],"sourcesContent":["// src/app/(auth)/onboarding/actions.ts\r\n\"use server\";\r\n\r\nimport { revalidatePath } from \"next/cache\";\r\nimport { redirect } from \"next/navigation\";\r\nimport { createClient } from \"@/utils/supabase/server\";\r\n\r\nexport async function updateProfile(formData: FormData) {\r\n  const supabase = await createClient();\r\n\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser();\r\n\r\n  if (userError || !user) {\r\n    redirect(\"/login\");\r\n  }\r\n\r\n  const { error } = await supabase.from(\"profiles\").upsert({\r\n    id: user.id,\r\n    full_name: formData.get(\"fullName\") as string,\r\n    username: formData.get(\"username\") as string,\r\n    bio: formData.get(\"bio\") as string,\r\n    updated_at: new Date().toISOString(),\r\n  });\r\n\r\n  if (error) {\r\n    redirect(\"/error?message=\" + encodeURIComponent(error.message));\r\n  }\r\n\r\n  revalidatePath(\"/\", \"layout\");\r\n  redirect(\"/dashboard\");\r\n}\r\n\r\nexport async function completeOnboarding(formData: FormData) {\r\n  const supabase = await createClient();\r\n\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser();\r\n\r\n  if (userError || !user) {\r\n    redirect(\"/login\");\r\n  }\r\n\r\n  // Extract form data\r\n  const userType = formData.get(\"userType\") as string;\r\n  const teamSize = formData.get(\"teamSize\") as string;\r\n  const referralSource = formData.get(\"referralSource\") as string;\r\n  const audioPurpose = formData.get(\"audioPurpose\") as string;\r\n  const paymentCompleted = formData.get(\"paymentCompleted\") === \"true\";\r\n  const micPermission = formData.get(\"micPermission\") === \"true\";\r\n\r\n  try {\r\n    // Check if onboarding record already exists\r\n    const { data: existingOnboarding } = await supabase\r\n      .from(\"user_onboarding\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .single();\r\n\r\n    const onboardingData = {\r\n      user_id: user.id,\r\n      completed_at: new Date().toISOString(),\r\n      answers: {\r\n        userType,\r\n        teamSize,\r\n        referralSource,\r\n        audioPurpose,\r\n        micPermission,\r\n      },\r\n      payment_completed: paymentCompleted,\r\n      user_type: userType,\r\n      team_size: teamSize,\r\n      referral_source: referralSource,\r\n      audio_purpose: audioPurpose,\r\n      mic_permission: micPermission,\r\n      updated_at: new Date().toISOString(),\r\n    };\r\n\r\n    let onboardingError;\r\n\r\n    if (existingOnboarding) {\r\n      // Update existing record\r\n      const { error } = await supabase\r\n        .from(\"user_onboarding\")\r\n        .update(onboardingData)\r\n        .eq(\"user_id\", user.id);\r\n      onboardingError = error;\r\n    } else {\r\n      // Insert new record (shouldn't happen in normal flow, but handle it)\r\n      const { error } = await supabase.from(\"user_onboarding\").insert({\r\n        ...onboardingData,\r\n        payment_link_tag: user.user_metadata?.payment_link_tag || null,\r\n      });\r\n      onboardingError = error;\r\n    }\r\n\r\n    if (onboardingError) {\r\n      console.error(\"Onboarding error:\", onboardingError);\r\n      return { error: onboardingError.message };\r\n    }\r\n\r\n    // Update user profile if needed\r\n    const { error: profileError } = await supabase.from(\"profiles\").upsert({\r\n      id: user.id,\r\n      onboarding_completed: true,\r\n      updated_at: new Date().toISOString(),\r\n    });\r\n\r\n    if (profileError) {\r\n      console.error(\"Profile update error:\", profileError);\r\n      // Don't return error here as onboarding data was saved successfully\r\n    }\r\n\r\n    console.log(\"✅ Onboarding completed successfully for user:\", user.id);\r\n\r\n    revalidatePath(\"/\", \"layout\");\r\n    redirect(\"/dashboard\");\r\n  } catch (error) {\r\n    console.error(\"Unexpected error during onboarding:\", error);\r\n    return {\r\n      error:\r\n        error instanceof Error ? error.message : \"An unexpected error occurred\",\r\n    };\r\n  }\r\n}\r\n\r\nexport async function checkPaymentStatus(userId: string) {\r\n  const supabase = await createClient();\r\n\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from(\"user_onboarding\")\r\n      .select(\"payment_completed, payment_link_tag\")\r\n      .eq(\"user_id\", userId)\r\n      .single();\r\n\r\n    if (error && error.code !== \"PGRST116\") {\r\n      // PGRST116 = Row not found\r\n      throw error;\r\n    }\r\n\r\n    return {\r\n      paymentCompleted: data?.payment_completed || false,\r\n      paymentLinkTag: data?.payment_link_tag || null,\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error checking payment status:\", error);\r\n    return {\r\n      paymentCompleted: false,\r\n      paymentLinkTag: null,\r\n      error:\r\n        error instanceof Error\r\n          ? error.message\r\n          : \"Failed to check payment status\",\r\n    };\r\n  }\r\n}\r\n\r\n// New function to verify payment completion (can be called from Stripe webhook)\r\nexport async function markPaymentCompleted(\r\n  userId: string,\r\n  stripeSessionId?: string\r\n) {\r\n  const supabase = await createClient();\r\n\r\n  try {\r\n    const updateData: any = {\r\n      payment_completed: true,\r\n      updated_at: new Date().toISOString(),\r\n    };\r\n\r\n    if (stripeSessionId) {\r\n      updateData.stripe_session_id = stripeSessionId;\r\n    }\r\n\r\n    const { error } = await supabase\r\n      .from(\"user_onboarding\")\r\n      .update(updateData)\r\n      .eq(\"user_id\", userId);\r\n\r\n    if (error) {\r\n      console.error(\"Error marking payment as completed:\", error);\r\n      return { error: error.message };\r\n    }\r\n\r\n    console.log(\"✅ Payment marked as completed for user:\", userId);\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"Unexpected error marking payment as completed:\", error);\r\n    return {\r\n      error:\r\n        error instanceof Error ? error.message : \"An unexpected error occurred\",\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 282, "column": 0}, "map": {"version":3,"sources":["file:///D:/breyholtz%20holding/arti-notes/arti-notes-v3/.next-internal/server/app/%28auth%29/onboarding/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {updateProfile as '40456e47ffa0d243b28358a525af33782f47e31018'} from 'ACTIONS_MODULE0'\nexport {completeOnboarding as '4017f1ee2c245e3435c2d9ce91fa88e32e84fe98b9'} from 'ACTIONS_MODULE0'\nexport {checkPaymentStatus as '40408aa358ff3c32694cfde6f469fcf704c3cdfddb'} from 'ACTIONS_MODULE0'\nexport {markPaymentCompleted as '60df81e3b58f784fc45f47aaaad31ef424016dbaeb'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 361, "column": 0}, "map": {"version":3,"sources":["file:///D:/breyholtz%20holding/arti-notes/arti-notes-v3/src/app/%28auth%29/onboarding/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(auth)/onboarding/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(auth)/onboarding/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAsS,GACnU,oEACA","debugId":null}},
    {"offset": {"line": 375, "column": 0}, "map": {"version":3,"sources":["file:///D:/breyholtz%20holding/arti-notes/arti-notes-v3/src/app/%28auth%29/onboarding/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(auth)/onboarding/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(auth)/onboarding/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAkR,GAC/S,gDACA","debugId":null}},
    {"offset": {"line": 389, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}